# SchedulerConfig

До версии 3.2.3 Ravyn поддерживал только [Asyncz][asyncz] для своего внутреннего планировщика.
Начиная с версии 3.2.3, поддержка Asyncz по-прежнему сохраняется, но теперь Ravyn делает её модульной,
как и всё остальное в системе.

Что это значит?

Это значит, что если вы не хотите использовать [Asyncz][asyncz] по каким-либо причинам,
вы можете просто создать свою конфигурацию и подключить собственный планировщик к Ravyn.

Теперь это стало возможным благодаря реализации **SchedulerConfig** в Ravyn.

## Как импортировать

Вы можете импортировать конфигурацию следующим образом:

```python
from ravyn.contrib.schedulers import SchedulerConfig
```

## Класс SchedulerConfig

При реализации конфигураций планировщика **вы должны реализовать** две функции.

1. [async def start()](#the-start-function)
2. [async def shutdown()](#the-shutdown-function)

Это делает `SchedulerConfig` модульным, поскольку существует много планировщиков, каждый из которых
предлагает множество различных опций и конфигураций. Однако у всех них есть одна общая черта:
все они должны запускаться и завершаться в какой-то момент. Единственное, что важно для Ravyn,
это возможность инкапсулировать эту функциональность в две простые функции.

### Функция start

Функция `start`, как следует из названия, является функцией, которую Ravyn вызывает за вас для
запуска планировщика. Это важно, потому что, когда установлен флаг `enable_scheduler`,
Ravyn будет искать конфигурацию планировщика и вызывать функцию `start` при запуске.

### Функция shutdown

Функция `shutdown`, как следует из названия, является функцией, которую Ravyn вызывает за вас
для завершения работы планировщика. Это важно, потому что, когда установлен флаг `enable_scheduler`,
Ravyn будет искать конфигурацию планировщика и вызывать функцию `shutdown` при остановке
(обычно, когда приложение останавливается).

### Как это использовать

Ravyn уже реализует этот интерфейс с помощью пользовательской `AsynczConfig`. Эта функциональность
очень полезна, поскольку Asyncz имеет множество конфигураций, которые можно передавать и использовать в
приложении Ravyn.

Давайте посмотрим, как выглядит реализация.

```python
{!> ../../../docs_src/scheduler/asyncz.py !}
```

Мы не будем углубляться в технические детали этой конфигурации, так как она уникальна для Asyncz,
предоставленного Ravyn, но **необязательно использовать именно его, так как вы можете создать
свою собственную конфигурацию** и передать её в параметр `scheduler_config` Ravyn.

### SchedulerConfig и приложение

Чтобы использовать `SchedulerConfig` в приложении, как показано выше с asyncz, вы можете сделать следующее:

!!! Note
    Мы используем существующий `AsynczConfig` в качестве примера, но не стесняйтесь использовать свою
    собственную конфигурацию, если вам нужно что-то другое.

```python
{!> ../../../docs_src/scheduler/example.py !}
```

Если вы хотите узнать [больше о том, как использовать AsynczConfig](../scheduler/index.md),
ознакомьтесь с соответствующим разделом.

### Жизненный цикл приложения

Планировщик Ravyn связан с жизненным циклом приложения, что означает, что он использует
события `on_startup/on_shutdown` и `lifespan`. Вы можете [узнать больше об этом](../lifespan-events.md)
в соответствующем разделе документации.

По умолчанию планировщик связан с событиями `on_startup/on_shutdown`, и они автоматически управляются
для вас, **но если вам требуется использовать lifespan**, то вы должны внести соответствующие изменения.

Следующий пример служит предложением, но не стесняйтесь использовать свой собственный дизайн.
Давайте посмотрим, как мы могли бы управлять этим с использованием `lifespan` вместо.

```python
{!> ../../../docs_src/scheduler/example2.py !}
```

Довольно просто, верно? Ravyn понимает, что нужно сделать как обычно.

### SchedulerConfig и настройки

Как и всё в Ravyn, SchedulerConfig также может быть доступен через настройки.

```python
{!> ../../../docs_src/scheduler/via_settings.py !}
```

## Важные заметки

- Вы можете создать свой собственный [настраиваемый конфиг для планировщика](#как-это-использовать).
- Вы **должны реализовать** функции `start/shutdown` в любой конфигурации планировщика.
- Вы можете использовать события `on_startup/shutdown` или `lifespan`. Первые автоматически управляются за вас.

[asyncz]: https://asyncz.dymmond.com
